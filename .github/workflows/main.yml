name: QT6 CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Qt6 with MinGW
        uses: jurplel/install-qt-action@v4.3.0
        with:
          version: 6.9.1
          host: windows
          target: desktop
          arch: win64_mingw

      - name: Add QT's MinGW to PATH
        run: |
          # 获取 QT 安装路径中的 MinGW 目录
          echo "QT_MINGW_PATH=${{ env.QT_INSTALL_DIR }}\mingw64\bin" >> $GITHUB_ENV
          echo "${{ env.QT_MINGW_PATH }}" >> $GITHUB_PATH

      - name: Verify MinGW
        run: |
          g++ --version
          mingw32-make --version

      - name: Configure and Build
        run: |
          mkdir build
          cd build
          cmake -DCMAKE_BUILD_TYPE=Release -G "MinGW Makefiles" -DCMAKE_PREFIX_PATH="${{ env.QT_INSTALL_DIR }}" ..
          mingw32-make
